  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'date_time'
      - 'date_time_utc'
      - 'date_time_iso'
      - 'time_date'
      - 'time_utc'
  - platform: bme280
    name: Ambient
    i2c_address: 0x77
    operation_mode: 2  # forced mode
    time_standby: 5
    oversampling_temperature: 1
    oversampling_pressure: 1
    oversampling_humidity: 1
    delta_temperature: -0.5
    monitored_conditions:
      - temperature
      - humidity
      - pressure
    scan_interval: 40
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_use_percent
      - type: processor_use
      - type: load_1m
      - type: load_5m
      - type: load_15m
      - type: throughput_network_in
        arg: wlan0
      - type: throughput_network_out
        arg: wlan0
      - type: last_boot
  - platform: command_line
    name: server_cpu_temp
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "Â°C"
    value_template: '{{ value | multiply(0.001) | round(2)  }}'
    scan_interval: 60
  - platform: template
    sensors:
      security_camera_last_snapshot:
        entity_id: input_datetime.security_camera_last_snapshot
        device_class: timestamp
        value_template: "{{ states('camera.security_camera_last_snapshot') }}"
      security_camera_last_snapshot_relative:
        entity_id: 
          - input_datetime.security_camera_last_snapshot
          - sensor.time
        value_template: >
          {%- set t = state_attr('input_datetime.security_camera_last_snapshot', 'timestamp') %}
          {%- if t != None %}
            {%- set n = now().timestamp() %}
            {%- set d = n-t %}
            {%- set midnight_today = as_timestamp(strptime(now().date() | string, "%Y-%m-%d")) %}
            {%- set midnight_yesterday = midnight_today - 86400 %}
            {%- set midnight_week_ago = midnight_today - 604800 %}
            {%- if d < 60 %}
              {{ d | int }} seconds ago
            {%- elif d >= 60 and d < 120 %}
              1 minute ago
            {%- elif d < 3600 %}
              {{ (d // 60) | int }} minutes ago
            {%- elif d < n-midnight_today %}
              Today at {{ t | timestamp_custom('%H:%M') }}
            {%- elif d < n-midnight_yesterday %}
              Yesterday at {{ t | timestamp_custom('%H:%M') }}
            {%- elif d < n-midnight_week_ago %}
              {{ t | timestamp_custom('%A at %H:%M') }}
            {%- else %}
              {{ t | timestamp_local }}
            {%- endif %}
          {% else %}
            unknown
          {% endif %}
      internet_speed_in:
        value_template: '{{ ((states.input_number.wan_traffic_delta_in.state  | float ) / 1000000 ) | round(3) }}'
        unit_of_measurement: 'Mbps'
      internet_speed_out:
        value_template: '{{ ((states.input_number.wan_traffic_delta_out.state | float ) / 1000000 ) | round(3) }}'
        unit_of_measurement: 'Mbps'
      internet_usage_in:
        value_template: "{{ ((states('sensor.snmp_wan_in')  | float ) / 1000000000 ) | round(3) }}"
        unit_of_measurement: 'GB'
      internet_usage_out:
        value_template: "{{ ((states('sensor.snmp_wan_out') | float ) / 1000000000 ) | round(3) }}"
        unit_of_measurement: 'GB'
  - platform: snmp
    name: snmp_wan_in
    host: 192.168.0.1
    community: Router
    version: 2c
    baseoid: 1.3.6.1.2.1.2.2.1.10.18  # ifInOctets.14
    unit_of_measurement: octets
  - platform: snmp
    name: snmp_wan_out
    host: 192.168.0.1
    community: Router
    version: 2c
    baseoid: 1.3.6.1.2.1.2.2.1.16.18  # ifOutOctets.14
    unit_of_measurement: octets
  - platform: statistics
    name: 'Internet Traffic In'
    entity_id: sensor.internet_speed_in
  - platform: statistics
    name: 'Internet Traffic Out'
    entity_id: sensor.internet_speed_out
  - platform: google_travel_time
    api_key: !secret google_maps_api_key
    origin: zone.pieter_work_cape_town
    destination: zone.home
    options:
      mode: driving
      departure_time: now
  - platform: filter
    name: google_travel_time_filtered
    entity_id: sensor.google_travel_time_driving
    filters: 
      filter: lowpass
      time_constant: 10
      precision: 0
  - platform: filter
    name: ambient_temperature_filtered
    entity_id: sensor.ambient_temperature
    filters: 
      filter: lowpass
      time_constant: 10
      precision: 1
  - platform: worldclock
    name: cape_town
    time_zone: Africa/Johannesburg
  - platform: worldclock
    name: san_francisco
    time_zone: America/Los_Angeles
  - platform: worldclock
    name: london
    time_zone: Europe/London